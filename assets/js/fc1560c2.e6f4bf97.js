"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[8592],{7522:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(9901);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=p(n),m=i,h=u["".concat(s,".").concat(m)]||u[m]||c[m]||o;return n?a.createElement(h,r(r({ref:t},d),{},{components:n})):a.createElement(h,r({ref:t},d))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,r[1]=l;for(var p=2;p<o;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},4692:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>c,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var a=n(5402),i=(n(9901),n(7522));const o={sidebar_position:3,toc_max_heading_level:4},r="Events",l={unversionedId:"apps-communication/events",id:"apps-communication/events",title:"Events",description:"There are a lot of cases, when Telegram sends events to Web App which,",source:"@site/docs/apps-communication/events.md",sourceDirName:"apps-communication",slug:"/apps-communication/events",permalink:"/twa/docs/apps-communication/events",draft:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,toc_max_heading_level:4},sidebar:"sidebar",previous:{title:"Methods",permalink:"/twa/docs/apps-communication/methods"},next:{title:"Launch parameters",permalink:"/twa/docs/category/launch-parameters"}},s={},p=[{value:"Web",id:"web",level:2},{value:"Desktop, mobile and Windows Phone",id:"desktop-mobile-and-windows-phone",level:2},{value:"Available events",id:"available-events",level:2},{value:"v6.0",id:"v60",level:3},{value:"<code>invoice_closed</code>",id:"invoice_closed",level:4},{value:"<code>main_button_pressed</code>",id:"main_button_pressed",level:4},{value:"<code>popup_closed</code>",id:"popup_closed",level:4},{value:"<code>set_custom_style</code>",id:"set_custom_style",level:4},{value:"<code>theme_changed</code>",id:"theme_changed",level:4},{value:"<code>viewport_changed</code>",id:"viewport_changed",level:4},{value:"v6.1",id:"v61",level:3},{value:"<code>back_button_pressed</code>",id:"back_button_pressed",level:4},{value:"<code>settings_button_pressed</code>",id:"settings_button_pressed",level:4},{value:"v6.4",id:"v64",level:3},{value:"<code>qr_text_received</code>",id:"qr_text_received",level:4},{value:"<code>scan_qr_popup_closed</code>",id:"scan_qr_popup_closed",level:4},{value:"<code>clipboard_text_received</code>",id:"clipboard_text_received",level:4}],d={toc:p};function c(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"events"},"Events"),(0,i.kt)("p",null,"There are a lot of cases, when Telegram sends events to Web App which,\nobviously, should be somehow handled. Like methods, each event has its unique\nname and payload."),(0,i.kt)("h2",{id:"web"},"Web"),(0,i.kt)("p",null,"As mentioned before, the web version uses a standard way of communication\nbetween iframes. It means, the parent iframe is able to send events\nthrough ",(0,i.kt)("inlineCode",{parentName:"p"},"postMessage")," function. To handle this type of message, it is enough to\nadd ",(0,i.kt)("inlineCode",{parentName:"p"},"message")," event listener on the global ",(0,i.kt)("inlineCode",{parentName:"p"},"window")," object."),(0,i.kt)("p",null,"The native application will send an event with ",(0,i.kt)("inlineCode",{parentName:"p"},"data: string")," which represents a\nJSON object converted to string. This object has the same interface as we\ndefined in the methods section:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"interface MessageJSON {\n  eventType: string;\n  eventData: any;\n}\n")),(0,i.kt)("p",null,"Simple example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"window.addEventListener('message', ({data}) => {\n  const {eventType, eventData} = JSON.parse(data);\n  console.log(eventType, eventData);\n})\n")),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"In this code, we assumed, that ",(0,i.kt)("inlineCode",{parentName:"p"},"message")," event is sent only by the native\napplication which is not always true in real applications. Additionally, we\ndidn't check if ",(0,i.kt)("inlineCode",{parentName:"p"},"data")," is really of type ",(0,i.kt)("inlineCode",{parentName:"p"},"string"),". Don't forget to check each\ntype and appropriately process incoming events.")),(0,i.kt)("h2",{id:"desktop-mobile-and-windows-phone"},"Desktop, mobile and Windows Phone"),(0,i.kt)("p",null,"Desktop, mobile, and Windows Phone versions of Telegram don\u2019t use the method,\ndescribed in the previous section. They do it in a bit unusual way. The first\nthing developer should know, is in case, when Telegram needs to emit an event,\nit will insert JavaScript code, which calls a globally defined function. Here is\nan example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"window.Telegram.WebView.receiveEvent('popup_closed', {button_id: 'cancel'});\n")),(0,i.kt)("p",null,"Path to this function depends on platform:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"window.TelegramGameProxy.receiveEvent")," - Telegram Desktop;"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"window.Telegram.WebView.receiveEvent")," - mobile applications;"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"window.TelegramGameProxy_receiveEvent")," - Windows Phone")),(0,i.kt)("p",null,"All of these functions have the same signature:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"type ReceiveEvent = (eventType: string, eventData: unknown) => void;\n")),(0,i.kt)("p",null,"So, the solution is rather simple. To handle incoming events we should create a\nfunction of this type and assign it to all 3 paths."),(0,i.kt)("h2",{id:"available-events"},"Available events"),(0,i.kt)("p",null,"This section contains the list of events, sent from Telegram: their names,\ndescription, and parameters. Section title means minimal version, from which\nevents inside the section could be sent."),(0,i.kt)("h3",{id:"v60"},"v6.0"),(0,i.kt)("h4",{id:"invoice_closed"},(0,i.kt)("inlineCode",{parentName:"h4"},"invoice_closed")),(0,i.kt)("p",null,"Invoice closed. Event contains passed\nduring ",(0,i.kt)("a",{parentName:"p",href:"methods#web_app_open_invoice"},(0,i.kt)("inlineCode",{parentName:"a"},"web_app_open_invoice"))," method\ninvocation ",(0,i.kt)("inlineCode",{parentName:"p"},"slug")," and invoice status."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"type Payload = {\n  slug: string;\n  status: 'paid' | 'failed' | 'pending' | 'cancelled';\n}\n")),(0,i.kt)("h4",{id:"main_button_pressed"},(0,i.kt)("inlineCode",{parentName:"h4"},"main_button_pressed")),(0,i.kt)("p",null,"User clicked ",(0,i.kt)("a",{parentName:"p",href:"../features/main-button"},"main button"),"."),(0,i.kt)("h4",{id:"popup_closed"},(0,i.kt)("inlineCode",{parentName:"h4"},"popup_closed")),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"../features/popup"},"Popup")," was closed. Payload will contain ",(0,i.kt)("inlineCode",{parentName:"p"},"button_id")," property\nwhich is identifier of clicked button. In case, no button was clicked, payload\nwill be empty object ",(0,i.kt)("inlineCode",{parentName:"p"},"{}"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"type Payload = { button_id?: string }\n")),(0,i.kt)("h4",{id:"set_custom_style"},(0,i.kt)("inlineCode",{parentName:"h4"},"set_custom_style")),(0,i.kt)("p",null,"The event is usually sent in the Telegram web version. Its payload\nrepresents ",(0,i.kt)("inlineCode",{parentName:"p"},"<style/>")," tag html content, a developer could use. The stylesheet\ndescribed in the payload will help the developer to stylize the app scrollbar\n(but he is still able to do it himself)."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"type Payload = string;\n")),(0,i.kt)("h4",{id:"theme_changed"},(0,i.kt)("inlineCode",{parentName:"h4"},"theme_changed")),(0,i.kt)("p",null,"Occurs whenever ",(0,i.kt)("a",{parentName:"p",href:"../features/theme"},"the theme")," was changed in the user's\nTelegram app (including switching to night mode).",(0,i.kt)("inlineCode",{parentName:"p"},"theme_params")," property is an\nobject with key-value pairs, where the key is some key\nname (",(0,i.kt)("inlineCode",{parentName:"p"},"bg_color"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"secondary_bg_color"),", etc.), and the value is its color\nin ",(0,i.kt)("inlineCode",{parentName:"p"},"#RRGGBB"),"format."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"type Payload = { theme_params: Record<string, string> };\n")),(0,i.kt)("h4",{id:"viewport_changed"},(0,i.kt)("inlineCode",{parentName:"h4"},"viewport_changed")),(0,i.kt)("p",null,"Occurs whenever the ",(0,i.kt)("a",{parentName:"p",href:"../features/viewport"},"viewport")," has been changed. For\nexample, when the user started dragging the application or called the expansion\nmethod."),(0,i.kt)("p",null,"Pay attention to the fact, that send rate of this method is not enough to\nsmoothly resize the application window. You should probably use a stable height\ninstead of the current one, or handle this problem in another way."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"type Payload = {\n  height: number;\n  width?: number;\n  is_expanded: boolean;\n  is_state_stable: boolean;\n};\n")),(0,i.kt)("h3",{id:"v61"},"v6.1"),(0,i.kt)("h4",{id:"back_button_pressed"},(0,i.kt)("inlineCode",{parentName:"h4"},"back_button_pressed")),(0,i.kt)("p",null,"User clicked ",(0,i.kt)("a",{parentName:"p",href:"../features/back-button"},"back button"),"."),(0,i.kt)("h4",{id:"settings_button_pressed"},(0,i.kt)("inlineCode",{parentName:"h4"},"settings_button_pressed")),(0,i.kt)("p",null,"Occurs when the ",(0,i.kt)("inlineCode",{parentName:"p"},"Settings")," item in context menu was pressed. Not all\napplications have this button."),(0,i.kt)("h3",{id:"v64"},"v6.4"),(0,i.kt)("h4",{id:"qr_text_received"},(0,i.kt)("inlineCode",{parentName:"h4"},"qr_text_received")),(0,i.kt)("p",null,"QR scanner scanned some QR and extracted its content."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"type Payload = {\n  req_id: string;\n  data?: string | null;\n};\n")),(0,i.kt)("h4",{id:"scan_qr_popup_closed"},(0,i.kt)("inlineCode",{parentName:"h4"},"scan_qr_popup_closed")),(0,i.kt)("p",null,"QR scanner was closed."),(0,i.kt)("h4",{id:"clipboard_text_received"},(0,i.kt)("inlineCode",{parentName:"h4"},"clipboard_text_received")),(0,i.kt)("p",null,"Telegram application attempted to extract text from clipboard."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"type Payload = {\n  data?: string;\n};\n")))}c.isMDXComponent=!0}}]);
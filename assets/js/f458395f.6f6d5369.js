"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[904],{7522:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>m});var n=a(9901);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var l=n.createContext({}),d=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},c=function(e){var t=d(e.components);return n.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=d(a),m=i,f=u["".concat(l,".").concat(m)]||u[m]||p[m]||r;return a?n.createElement(f,o(o({ref:t},c),{},{components:a})):n.createElement(f,o({ref:t},c))}));function m(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,o=new Array(r);o[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var d=2;d<r;d++)o[d]=a[d];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},9835:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>d});var n=a(5402),i=(a(9901),a(7522));const r={sidebar_position:2},o="twa-init-data",s={unversionedId:"libraries/twa-init-data",id:"libraries/twa-init-data",title:"twa-init-data",description:"TypeScript isomorphic library to make work with Telegram Web Apps init data",source:"@site/docs/libraries/twa-init-data.mdx",sourceDirName:"libraries",slug:"/libraries/twa-init-data",permalink:"/twa/docs/libraries/twa-init-data",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"sidebar",previous:{title:"twa-bridge",permalink:"/twa/docs/libraries/twa-bridge"},next:{title:"twa-theme-params",permalink:"/twa/docs/libraries/twa-theme-params"}},l={},d=[{value:"Installation",id:"installation",level:2},{value:"Usage",id:"usage",level:2},{value:"Parsing",id:"parsing",level:3},{value:"Validation",id:"validation",level:3}],c=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,i.kt)("div",t)},p=c("NpmMeta"),u=c("NpmInstall"),m=c("NpmLink"),f={toc:d};function h(e){let{components:t,...a}=e;return(0,i.kt)("wrapper",(0,n.Z)({},f,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"twa-init-data"},"twa-init-data"),(0,i.kt)("p",null,"TypeScript isomorphic library to make work with Telegram Web Apps init data\neasier. Could be used both in browser and Node JS."),(0,i.kt)(p,{pkg:"twa-init-data",mdxType:"NpmMeta"}),(0,i.kt)("h2",{id:"installation"},"Installation"),(0,i.kt)(u,{pkg:"twa-init-data",mdxType:"NpmInstall"}),(0,i.kt)("h2",{id:"usage"},"Usage"),(0,i.kt)("p",null,"First thing which is required to know, is this library has peer dependency called ",(0,i.kt)(m,{pkg:"crypto-js",mdxType:"NpmLink"})," which provides crypto algorithms used during init data validation."),(0,i.kt)("p",null,"In case, you need only parsing utilities (for example, in browser), you have no need to install this dependency as long as it is not imported in parsing files. In this case, you have to follow the only 1 rule - do not import from `twa-init-data/validate` because this will lead to ",(0,i.kt)(m,{pkg:"crypto-js",mdxType:"NpmLink"})," import and will result in error."),(0,i.kt)("p",null,"If init data validation is needed, you have to install ",(0,i.kt)(m,{pkg:"crypto-js",mdxType:"NpmLink"})," dependency by yourself."),(0,i.kt)("h3",{id:"parsing"},"Parsing"),(0,i.kt)("p",null,"This library contains function ",(0,i.kt)("inlineCode",{parentName:"p"},"extractInitDataFromSearchParams")," which is\nable to extract init data information from query parameters. Here comes the\nexample of usage:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import {extractInitDataFromSearchParams} from 'twa-init-data';\n\n// Let's imagine, we have init data in raw format like this. Web Apps are\n// sending it in the exact same format.\nconst initDataRaw = 'query_id=AAHdF6IQAAAAAN0XohDhrOrc&user=%7B%22id%22%3A279058397%2C%22first_name%22%3A%22Vladislav%22%2C%22last_name%22%3A%22Kibenko%22%2C%22username%22%3A%22vdkfrost%22%2C%22language_code%22%3A%22ru%22%2C%22is_premium%22%3Atrue%7D&auth_date=1662771648&hash=c501b71e775f74ce10e377dea85a7ea24ecd640b223ea86dfe453e0eaed2e2b2';\n\n// Extract init data.\nconsole.log(extractInitDataFromSearchParams(initDataRaw));\n\n// Output:\n// {\n//   authDate: 2022-09-10T01:00:48.000Z,\n//   hash: 'c501b71e775f74ce10e377dea85a7ea24ecd640b223ea86dfe453e0eaed2e2b2',\n//   queryId: 'AAHdF6IQAAAAAN0XohDhrOrc',\n//   user: {\n//     id: 279058397,\n//     firstName: 'Vladislav',\n//     lastName: 'Kibenko',\n//     username: 'vdkfrost',\n//     languageCode: 'ru',\n//     isPremium: true\n//   }\n// }\n")),(0,i.kt)("p",null,"Function extracts required parameters and automatically validates their types.\nIt will throw an error in case, some property has invalid type or value."),(0,i.kt)("h3",{id:"validation"},"Validation"),(0,i.kt)("p",null,"In case, validation functionality is required, it is necessary to install",(0,i.kt)(m,{pkg:"crypto-js",mdxType:"NpmLink"})," package."),(0,i.kt)("p",null,"To validate init data sign, function ",(0,i.kt)("inlineCode",{parentName:"p"},"validate")," is used. It expects passing init\ndata presented in raw format (search params) and throws an error in case,\nsomething is wrong. To see full list of errors, please, check function's JSDoc.\nFunction does not return any result."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import {validate} from 'twa-init-data/validate';\n\nconst initDataRaw = 'query_id=AAHdF6IQAAAAAN0XohDhrOrc&user=%7B%22id%22%3A279058397%2C%22first_name%22%3A%22Vladislav%22%2C%22last_name%22%3A%22Kibenko%22%2C%22username%22%3A%22vdkfrost%22%2C%22language_code%22%3A%22ru%22%2C%22is_premium%22%3Atrue%7D&auth_date=1662771648&hash=c501b71e775f74ce10e377dea85a7ea24ecd640b223ea86dfe453e0eaed2e2b2';\nconst secretToken = '5768337691:AAH5YkoiEuPk8-FZa32hStHTqXiLPtAEhx8';\n\nvalidate(initDataRaw, secretToken);\n")),(0,i.kt)("p",null,"By default, function checks init data expiration. Default expiration duration\nis 1 day (86_400 seconds). It is recommended to always check init data\nexpiration as long as it could be stolen, but still valid. To disable this\nfeature, use third function argument as follows:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import {validate} from 'twa-init-data/validate';\n\nconst initDataRaw = 'query_id=AAHdF6IQAAAAAN0XohDhrOrc&user=%7B%22id%22%3A279058397%2C%22first_name%22%3A%22Vladislav%22%2C%22last_name%22%3A%22Kibenko%22%2C%22username%22%3A%22vdkfrost%22%2C%22language_code%22%3A%22ru%22%2C%22is_premium%22%3Atrue%7D&auth_date=1662771648&hash=c501b71e775f74ce10e377dea85a7ea24ecd640b223ea86dfe453e0eaed2e2b2';\nconst secretToken = '5768337691:AAH5YkoiEuPk8-FZa32hStHTqXiLPtAEhx8';\n\nvalidate(initDataRaw, secretToken, {expiresIn: 0});\n")))}h.isMDXComponent=!0}}]);